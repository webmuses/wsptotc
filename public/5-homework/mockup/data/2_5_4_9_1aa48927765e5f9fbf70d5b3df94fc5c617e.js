(function(){var b=function(c){var d={"\\[([a-zA-Z\\-]+)=([^\\]]+)\\]":function(f){var g={};g[f[1]]=f[2];return g},"#([a-zA-Z][a-zA-Z0-9\\-_]*)":function(f){return{id:f[1]}},"\\.([a-zA-Z][a-zA-Z0-9\\-_]*)":function(f){return{"class":f[1]}}},e={};new Hash(d).each(function(h,g){var f;g=new RegExp(g);while(c.test(g)){f=c.match(g);$extend(e,h(f));c=c.replace(f[0],"")}});return[c,e]};var a=function(c){var d=function(f,e){f.each(function(h){if(!h){return}if(typeof h=="string"){e.innerHTML+=h}else{if(typeof h[0]=="string"){var k=b(h.shift()),i=new Element(k[0]),g={}.toString.call(h[0])==="[object Object]"?h.shift():{};$extend(g,k[1]);g&&i.setProperties(g);e.appendChild(d(h,i))}else{if(h.nodeType===1||h.nodeType===11){e.appendChild(h)}else{d(h,e)}}}});return e};return d(c,document.createDocumentFragment())};Element.implement({microjungle:function(c){this.appendChild(a(c));return this}})})();var lscache=function(){var j="lscache-";var o="-cacheexpiration";var l=10;var i=60*1000;var d=Math.floor(8640000000000000/i);var c;var k;var e="";function h(){var q="__lscachetest__";var r=q;if(c!==undefined){return c}try{g(q,r);m(q);c=true}catch(p){c=false}return c}function a(){if(k===undefined){k=(window.JSON!=null)}return k}function f(p){return p+o}function b(){return Math.floor((new Date().getTime())/i)}function n(p){return localStorage.getItem(j+e+p)}function g(p,q){localStorage.removeItem(j+e+p);localStorage.setItem(j+e+p,q)}function m(p){localStorage.removeItem(j+e+p)}return{set:function(w,v,r){if(!h()){return}if(typeof v!=="string"){if(!a()){return}try{v=JSON.stringify(v)}catch(u){return}}try{g(w,v)}catch(u){if(u.name==="QUOTA_EXCEEDED_ERR"||u.name==="NS_ERROR_DOM_QUOTA_REACHED"){var y=[];var q;for(var t=0;t<localStorage.length;t++){q=localStorage.key(t);if(q.indexOf(j+e)===0&&q.indexOf(o)<0){var z=q.substr((j+e).length);var p=f(z);var x=n(p);if(x){x=parseInt(x,l)}else{x=d}y.push({key:z,size:(n(z)||"").length,expiration:x})}}y.sort(function(B,A){return(A.expiration-B.expiration)});var s=(v||"").length;while(y.length&&s>0){q=y.pop();m(q.key);m(f(q.key));s-=q.size}try{g(w,v)}catch(u){return}}else{return}}if(r){g(f(w),(b()+r).toString(l))}else{m(f(w))}},get:function(q){if(!h()){return null}var p=f(q);var u=n(p);if(u){var t=parseInt(u,l);if(b()>=t){m(q);m(p);return null}}var r=n(q);if(!r||!a()){return r}try{return JSON.parse(r)}catch(s){return r}},remove:function(p){if(!h()){return null}m(p);m(f(p))},supported:function(){return h()},flush:function(){if(!h()){return}for(var q=localStorage.length-1;q>=0;--q){var p=localStorage.key(q);if(p.indexOf(j+e)===0){localStorage.removeItem(p)}}},setBucket:function(p){e=p},bucket:function(s,r){var q=e,p;if(q==s){return r()}this.setBucket(s);p=r();this.setBucket(q);return p},resetBucket:function(){e=""}}}();var DPMainToolbar=new Class({mItems:[],mParentEl:document.body,initialize:function(){this.pageWidget=new DPMainToolbar_Widget_Page();this.link_button=new DPMainToolbar_Widget_Button_Link();this.mItems=[this.pageWidget,new DPMainToolbar_Widget_ButtonGroup("tools",[new DPMainToolbar_Widget_UndoRedo(),new DPMainToolbar_Widget_Button_Group(),new DPMainToolbar_Widget_Button({tooltip:"Arrange",class_name:"arrange",onRefresh:function(){var a=dpManager.dpWorkBench.getActivePage().getActiveElements().map(function(b){return b.getProperty("locked")}).unique();if(a.length>1||(1==a.length&&0==a.pop())){this.mEl.removeClass("inactive")}else{this.mEl.addClass("inactive")}},onClick:function(a){if(this.toolbar){this.toolbar.destroy();this.toolbar=null;return}this.toolbar=new dmsDPPropertyToolbar_Toolbar_Core(a,null,{position:"bottom",container:dpManager.dpMainToolbar.getEl(),class_name:"arrange",offset:7,onDestroy:function(){this.mEl.removeClass("pushed");this.toolbar=null}.bind(this)});this.toolbar.addWidget(new DPMainToolbar_Widget_Toolbar_Arrange());this.toolbar.toggle(true);this.mEl.addClass("pushed")}}),this.link_button,new DPMainToolbar_Widget_Button_Lock(),new DPMainToolbar_Widget_Button_Image()]),new DPMainToolbar_Widget_ButtonGroup("",[new DPMainToolbar_Widget_Width(),new DPMainToolbar_Widget_Height(),new DPMainToolbar_Widget_Opacity()]),new DPMainToolbar_Widget_ButtonGroup("action",[new DPMainToolbar_Widget_Button_Configure(),new DPMainToolbar_Widget_Button({text:"Share",class_name:"sharing",tooltip:"Share (Preview, Share by email, Download as HTML)",onClick:function(a){if(this.toolbar){this.toolbar.destroy();return}this.toolbar=new dmsDPPropertyToolbar_Toolbar_Core(a,null,{position:"bottom",container:dpManager.dpMainToolbar.getEl(),class_name:"share",offset:7,onDestroy:function(){this.toolbar=null;this.mEl.removeClass("pushed")}.bind(this)});this.toolbar.addWidget(new DPMainToolbar_Widget_Toolbar_Share());this.toolbar.toggle(true);this.mEl.addClass("pushed")}}),new DPMainToolbar_Widget_Button({class_name:"primary iteration",text:"Create iteration",tooltip:"By creating a new iteration you are saving<br> your work at its current stage.You will always<br> be able to come back to this version, retrieve it,<br> or pass a link to it for a review",onClick:function(b){var a=new DPProject_VersionCommit({container:b.getParent(),id_project:dpManager.dpProject.getIdProject(),onCommit:function(){b.addClass("inactive");GAnal.trackEvent("editor","create-iteration");mixpanel.track("Create iteration")},onDispose:function(){b.removeClass("inactive")}});if(!b.hasClass("inactive")){a.commit();a.getEl().position({relativeTo:dpManager.dpWorkBench.getWorkBenchElMain(),position:"upperRight",edge:"upperRight",offset:{y:10+dpManager.dpWorkBench.getWorkBenchElMain().getScrollTop(),x:-27+dpManager.dpWorkBench.getWorkBenchElMain().getScrollLeft()}})}}})])];this.render();dpManager.dpWorkBench.addEvent("onPageLoaded",function(){dpManager.dpWorkBench.getActivePage().addEvent("onActivateElements",this.refresh.bind(this))}.bind(this))},render:function(){this.mEl=new Element("div",{id:"DPMainToolbar"});this.mItems.each(function(a){a.render(this.mEl)}.bind(this));this.mEl.inject(this.mParentEl);this.refresh();if(document.getElement("#trial-info")){this.mEl.setStyle("top",25)}return this},getEl:function(){return this.mEl},refresh:function(a){this.mItems.each(function(b){b.refresh(a)}.bind(this));return this}});var DPMainToolbar_Widget=new Class({Implements:[Options],mEl:null,initialize:function(a){this.setOptions(a)},isActive:function(){},refresh:function(a){},render:function(a){}});var DPMainToolbar_Widget_Button=new Class({Implements:[Events,Options],options:{text:"",tooltip:"",class_name:""},mEl:null,mTooltipEl:null,initialize:function(a){this.setOptions(a)},render:function(b){var a;this.mEl=new Element("a",{"class":"btn "+this.options.class_name,href:"#",events:{click:function(c){this.fireEvent("click",[this.mEl,c]);return false}.bind(this)}}).inject(b);a=[["i",this.options.text]];this.mEl.microjungle(a);this.mTooltipEl=this.mEl.getElement("span.hint em");if(this.options.tooltip){this.renderTooltip();this.mTooltipEl.set("html",this.options.tooltip)}return this},renderTooltip:function(){this.mTooltipEl=new Element("em");this.mEl.microjungle([["span.hint",[this.mTooltipEl]]])},refresh:function(){try{if(!dpManager.dpWorkBench.getActivePage()){return}this.fireEvent("refresh",[this.mEl])}catch(a){return false}}});var DPMainToolbar_Widget_ButtonGroup=new Class({Extends:DPMainToolbar_Widget,options:{class_name:""},mItems:[],initialize:function(b,a){this.setOptions({class_name:b});this.mItems=a||[]},render:function(b){var a="group";if(this.options.class_name){a+=" "+this.options.class_name}this.mEl=new Element("span",{"class":a}).inject(b);this.mItems.each(function(c){c.render(this.mEl)}.bind(this))},refresh:function(a){this.mItems.each(function(b){b.refresh(a)})}});var DPMainToolbar_Widget_CheckboxGroup=new Class({Implements:[Events,Options],options:{tooltip:"",class_name:"",load:$empty,options:[{id:"",label:"",value:"",checked:"",click:$empty}]},mEl:null,mTooltipEl:null,initialize:function(a){this.setOptions(a)},render:function(a){this.mEl=new Element("span",{"class":"check "+this.options.class_name}).inject(a);this.options.options.each(function(e){var c=new Element("span").inject(this.mEl);var d=new Element("input",{id:e.id,type:"checkbox",value:e.value,checked:e.checked,events:{click:function(f){if(typeof e.click=="function"){e.click(f,this)}return true}}}).inject(c);var b=new Element("label",{"class":"checkbox-label","for":e.id,html:e.label}).inject(c)}.bind(this));this.mTooltipEl=this.mEl.getElement("span.hint em");if(this.options.tooltip){this.renderTooltip();this.mTooltipEl.set("html",this.options.tooltip)}this.addEvent("load",this.options.load.bind(this));this.fireEvent("load");return this},renderTooltip:function(){this.mTooltipEl=new Element("em");this.mEl.microjungle([["span.hint",[this.mTooltipEl]]])},refresh:function(){try{if(!dpManager.dpWorkBench.getActivePage()){return}this.fireEvent("refresh",[this.mEl])}catch(a){return false}}});var DPSidebar=new Class({Implements:[Events],mEl:null,mCookieName:"sidebar_config",Resizer:null,Cookie:null,mItems:null,initialize:function(c){var a;this.mItems=new Hash({home:new DPSidebar_Widget_Home("nav"),elements:new DPSidebar_Widget_Elements("nav"),components:new DPSidebar_Widget_Components("nav"),search:new DPSidebar_Widget_TheSearchLaunch("nav"),annotate:new DPSidebar_Widget_Annotate("nav"),news:new DPSidebar_Widget_HelpOverlay("subnav"),avatar:new DPSidebar_Widget_Avatar("subnav"),help:new DPSidebar_Widget_Help("subnav")});this.render(c||{});this.Cookie=new Cookie(this.mCookieName,{duration:365,path:"/"});this.setResizer();a=this.getConfig("active_tab");if(a&&this.mItems.get(a)){this.mItems.get(a).show({animate:false})}var b=new Cookie("new_design_info",{duration:999,path:"/"});if(!b.read()){this.mItems.news.mEl.fireEvent("click");b.write(1)}},setResizer:function(){this.Resizer=new DPSidebar_WorkBenchResizer()},getWidget:function(a){return this.mItems.get(a)},render:function(a){this.mEl=new Element("div",{id:"sidebar"}).inject(document.body);var b=new Element("ul",{"class":"nav"}).inject(this.mEl),c=new Element("ul",{"class":"subnav"}).inject(this.mEl);if(document.getElement("#trial-info")){c.setStyle("bottom",25)}this.mItems.each(function(e,g){var d="nav"===e.getSection()?b:c,f=new Element("li",{"class":g}).inject(d);if(a&&undefined!==a[g]){e.setOptions(a[g])}e.setSidebar(this);e.render(f);e.addEvents({show:function(h,i){this.hideOtherToolbars(e);this.setConfig("active_tab",g);this.fireEvent("toolbarShow",[h,"show",i])}.bind(this),hide:function(h,i){this.setConfig("active_tab",null);this.fireEvent("toolbarHide",[h,"hide",i])}.bind(this)});e.afterInit&&e.afterInit()},this)},hideOtherToolbars:function(a){this.mItems.getValues().each(function(b){if(!(b instanceof DPSidebar_Widget_FloatingToolbar)||b===a){return}if(!b.isToolbarVisible()){return}b.hide({resize_workbench:false})})},setConfig:function(a,b){var c=this.getConfig();c[a]=b;this.Cookie.write(JSON.encode(c))},getConfig:function(a){var c=this.Cookie.read(),b=(c&&JSON.parse(c))||{};if(a){return b[a]||null}return b},getItems:function(){return this.mItems},isAnyToolbarVisible:function(){return this.mItems.some(function(a){return a.mOn==true})}});var DPSidebar_Widget=new Class({Implements:[Events,Options],mSection:null,mSidebar:null,mEl:null,initialize:function(a){this.mSection=a},getSection:function(){return this.mSection},setSidebar:function(a){this.mSidebar=a},render:function(a){}});var DPSidebar_WorkBenchResizer=new Class({Implements:[Events],mMorphLockCounter:0,mElements:null,initialize:function(){this.mElements=new Hash({workbench:dpManager.dpWorkBench.getWorkBenchElMain(),container:dpManager.dpWorkBench.getWorkBenchElMain().getParent()})},resize:function(a){if(this.isLocked()){return}if(a.animate){this._animate(a.width)}else{this._resize(a.width)}},isLocked:function(){return this.mMorphLockCounter>0},_resize:function(a){var b=this.calculateStyles(a);this.mElements.each(function(d,c){d.setStyles(b[c])});this.fireEvent("complete")},_animate:function(a){var c=this.prepareFx(),b=this.calculateStyles(a);this.mElements.getKeys().each(function(d){c[d].start(b[d])})},calculateStyles:function(a){var c=this.mElements.workbench,b=this.mElements.container;return{workbench:{width:c.getStyle("width").toIntZero()+a},container:{width:b.getStyle("width").toIntZero()+a,left:b.getStyle("left").toIntZero()-a}}},prepareFx:function(){var b={onStart:function(){this.mMorphLockCounter+=1}.bind(this),onComplete:function(){this.mMorphLockCounter-=1;if(0==this.mMorphLockCounter){this.fireEventOnce("complete")}}.bind(this)},a={};this.mElements.each(function(d,c){a[c]=new Fx.Morph(d,b)});return a}});var DPSidebar_Widget_FloatingToolbar=new Class({Implements:DPSidebar_Widget,mToolbarEl:null,mToolbarWidth:240,mToolbarName:null,mToggleShortcut:null,mOn:null,renderToolbar:function(){this.mToolbarEl=new Element("div",{"class":"sidebar-toolbar",styles:{width:this.mToolbarWidth}}).hide().inject(document.body);if(document.getElement("#trial-info")){this.mToolbarEl.setStyle("top",75)}if(undefined!==this.mToolbarName){this.mToolbarEl.addClass(this.mToolbarName)}},show:function(c){this.mOn=true;var b=this.areOtherToolbarsActive(),a={animate:true,resize_workbench:b?false:true};$extend(a,c||{});this.mEl.addClass("active");this.mToolbarEl.show();this.fireEvent("show",[this,a]);a.resize_workbench&&this.mSidebar.Resizer.resize({width:-this.mToolbarWidth,animate:a.animate});if(dpManager&&dpManager.dpPageInspector){dpManager.dpPageInspector.sidebarShown();this.adjustToSitemap()}},afterInit:function(){if(this.mToggleShortcut&&dpManager){dpManager.dpShortcuts.addShortcut(this.mToggleShortcut,this.toggle.bind(this))}},areOtherToolbarsActive:function(){return this.mSidebar.getItems().getValues().some(function(a){if(a===this){return false}if(a instanceof DPSidebar_Widget_FloatingToolbar&&a.isToolbarVisible()){return true}return false}.bind(this))},hide:function(b){this.mOn=false;var a={animate:true,resize_workbench:true};$extend(a,b||{});this.mEl.removeClass("active");this.fireEvent("hide",[this,a]);if(a.resize_workbench){this.mSidebar.Resizer.addEvent("complete",function(){this.mToolbarEl.hide()}.bind(this)).resize({width:this.mToolbarWidth,animate:a.animate})}else{this.mToolbarEl.hide()}if(dpManager){dpManager.dpPageInspector.sidebarWasHidden()}},toggle:function(a){if(this.mSidebar.Resizer.isLocked()){return}if(this.isToolbarVisible()){this.hide(a)}else{this.show(a)}},getToolbarEl:function(){return this.mToolbarEl},isToolbarVisible:function(){return this.mToolbarEl.isVisible()},adjustToSitemap:function(b){if(b===undefined&&document.getElement(".property-toolbar.page-inspector")){b=document.getElement(".property-toolbar.page-inspector").getSize().y}b=b||0;var d=document.getElement("#trial-info")?75:50;var c=d+b;this.mToolbarEl.setStyle("top",c);if(this.mToolbarEl.getElement(".sidebar-wrapper")){var a=this.mToolbarEl.getElements(".category-title, .search").map(function(e){return e.getHeight()}).sum();this.mToolbarEl.getElement(".sidebar-wrapper").setStyle("height",document.getElement("#sidebar").getSize().y-a-d-b)}}});var dmsDPPreview_Comet=new Class({mActiveLayer:1,mMenu:null,initialize:function(){if(!Preview.isCollaborationEnabled()){return}this.mComet=new DPComet(Preview.getData().id_project,Preview.getData().project_hash,Preview.isCollaborationEnabled());this.mComet.addEvent("onChangeElements",this.onPushPage.bind(this));this.mComet.addEvent("onSetComponent",this.onPushPage.bind(this));this.mComet.addEvents({onUpdatePage:this.onPushMenu.bind(this),onSortOrder:this.onPushMenu.bind(this),onAddPage:this.onPushMenu.bind(this),onDeletePage:this.onPushMenu.bind(this)});this.mAjaxPageChange=new Dejax();this.mAjaxMenuChange=new Dejax();$("main1").setStyles("opacity",1);$("main2").setStyles("opacity",0)},onPushPage:function(a){if(a.id_page!=Preview.getData().id_page&&1!=a.is_component){return}this.mAjaxPageChange.newRequest({url:"/ajax/dmsDPPreview/GetPageContent/","eval":true,mode:"cancel",data:{id_page:Preview.getData().id_page,id_project:Preview.getData().id_project,project_hash:Preview.getData().project_hash,menu_enabled:Preview.isMenuEnabled(),active_collaboration:Preview.isCollaborationEnabled()},onComplete:this.loadPage.bind(this)})},loadPage:function(b){if(Browser.Engine.trident){$("main1").set("html",b)}else{var a=this.mActiveLayer;this.mActiveLayer=this.mActiveLayer==1?2:1;$("main"+this.mActiveLayer).set("html",b);$("main"+a).setStyle("z-index",11).set("tween",{duration:300,link:"cancel"}).tween("opacity",0);$("main"+this.mActiveLayer).setStyle("z-index",10).set("tween",{duration:150,link:"cancel"}).tween("opacity",1)}},onPushMenu:function(){this.mAjaxMenuChange.newRequest({url:"/ajax/dmsDPPreview/GetPagesToMenu/","eval":true,mode:"cancel",data:{project_hash:Preview.getData().project_hash},onComplete:this.loadMenu.bind(this)})},loadMenu:function(a){Preview.Menu.load(a)}});var dmsDPPreview_Menu=new Class({mTreeControl:null,mIconsMap:{Analytics:"21","Business Model Canvas":"22","Project Canvas":"23","Conceptual Diagram":"24",Persona:"25",Sitemap:"26",Specification:"27",Userflow:"28","Visual Design":"29",Wireframe:"30",Other:"31"},mEl:null,mParentEl:null,mIconsPath:null,initialize:function(a){this.mParentEl=a;this.mIconsPath=this.getIconsPath()},getIconsPath:function(){if(!Preview.isExport()){return"/mp/MooTreeControl/"}if(window.location.href.test(/\/pages\//)){return"../data/"}return"data/"},load:function(d){if(!d){return}if(this.mTreeControl){this.mTreeControl.remove()}var c=new Element("div",{styles:{"margin-left":"-10px"}}).inject(this.mParentEl);this.mTreeControl=new MooTreeControl({div:c,mode:"files",grid:true,draggable:false,theme:this.mIconsPath+"mootree.png?v2",nodeOptions:{text:"Pages",open:true}});this.mTreeControl.div.getElement(".mooTree_node:first-child").hide();this.mTreeControl.root.options.draggable=false;this.mTreeControl.root.divs.node.removeEvents("click");this.mTreeControl.root.divs.node.disableSelection();var a=function(e){if(e.url){window.location=e.url;return}this.loadMenuPage(e.id_page)}.bind(this);var b=Preview.getData().id_project;d.each(function(e){var f=this.mIconsPath+"mootree.png?v2#",i,g;if(e.parent){i=this.mTreeControl.get(e.parent)}else{i=this.mTreeControl.root}if(e.is_category){if($defined(this.mIconsMap[e.name])){f+=this.mIconsMap[e.name]}else{f+=this.mIconsMap.Other||"11"}}else{f+="11"}g=i.insert({text:e.name,id:e.id||e.id_page,selected:true,open:false,icon:f,data:{id_page:e.id_page||null,url:e.url},onSelect:function(){var j=this;if(this.data.id_page){a(this.data);return}while(j.getFirst()){j=j.getFirst();if(j.data.id_page){a(j.data);return}}},onExpand:function(l){var k=lscache.bucket(b,function(){return lscache.get("open_nodes")||[]});if(l===true&&k.contains(this.data.id_page)===false){k.push(this.data.id_page)}else{if(l===false&&k.contains(this.data.id_page)){var j=k.indexOf(this.data.id_page);k.splice(j,1)}}lscache.bucket(b,function(){lscache.set("open_nodes",JSON.encode(k))})}},false);var h=lscache.bucket(b,function(){return lscache.get("open_nodes")||[]});if(Preview.getData().id_page==e.id_page||h.contains(e.id_page)){g.toggleParent()}}.bind(this));this.mTreeControl.root.update(true);this.mTreeControl.select(this.mTreeControl.get(Preview.getData().id_page),true)},remove:function(){this.mTreeControl.remove()},loadMenuPage:function(a){var b=Preview.getData().page_base_url.replace(":id_page",a);if(false===Preview.getData().active_collaboration){b+="d"}if(false===Preview.getData().menu_enabled){b+="m"}window.location=b}});var dmsDPPreview_Sidebar=new Class({Extends:DPSidebar,mCookieName:"preview_sidebar_config",mItems:new Hash(),initialize:function(){this.Cookie=new Cookie(this.mCookieName,{duration:365});this.setResizer()},setActiveTab:function(){var a=this.getConfig("active_tab");if(a){this.mItems.get(a).show({animate:false})}},setResizer:function(){this.Resizer=new dmsDPPreview_Sidebar_Resizer()},addWidget:function(a,b){this.mItems.set(a,b)}});var dmsDPPreview_Sidebar_Back=new Class({Extends:DPSidebar_Widget,render:function(a){this.mEl=new Element("a",{href:"/dms/Collections/Show/%d".sprintf(Preview.getData().id_collection),"data-tooltip":"Dashboard",text:"Dashboard"}).inject(a)}});var dmsDPPreview_Sidebar_Comments=new Class({Extends:DPSidebar_Widget_FloatingToolbar,mToolbarName:"comments",initialize:function(a){this.parent(a);this.mResizeRef=this.resizeToolbar.bind(this);this.addEvents({show:function(){this.resizeToolbar();window.addEvent("resize",this.mResizeRef)}.bind(this),hide:function(){window.removeEvent("resize",this.mResizeRef)}.bind(this)})},render:function(a){this.mEl=new Element("a",{href:"#","data-tooltip":"Comments",text:"Comments",events:{click:function(){this.toggle({animate:true});return false}.bind(this)}}).inject(a);this.renderToolbar()},resizeToolbar:function(){var a=window.height;this.mToolbarEl.setStyles({overflow:"auto"})}});var dmsDPPreview_Sidebar_Resizer=new Class({Extends:DPSidebar_WorkBenchResizer,initialize:function(){this.mElements=new Hash({canvas:document.getElement("#canvas")})},calculateStyles:function(a){return{canvas:{left:this.mElements.canvas.getStyle("left").toIntZero()-a}}}});var dmsDPPreview_Sidebar_Sitemap=new Class({Extends:DPSidebar_Widget_FloatingToolbar,mToolbarName:"sitemap",render:function(a){this.mEl=new Element("a",{href:"#","data-tooltip":"Sitemap",text:"Sitemap",events:{click:function(){this.toggle({animate:true});return false}.bind(this)}}).inject(a);this.renderToolbar()}});var dmsDPPreview_Preview=new Class({Sidebar:null,MainToolbar:null,Menu:null,mData:null,mCanvasEl:null,initialize:function(){this.mCanvasEl=document.getElement("#canvas");this.canvasResize();window.addEvent("resize",this.canvasResize.bind(this))},setData:function(a){this.mData=a;this.canvasResize()},getData:function(){return this.mData},createMainToolbar:function(){this.MainToolbar=new dmsDPPreview_MainToolbar();this.mCanvasEl.getElement("#canvas-wrapper").setStyle("top","50px");this.canvasResize()},createSidebar:function(a){this.Sidebar=new dmsDPPreview_Sidebar();if(a.show_back_widget){this.Sidebar.addWidget("home",new dmsDPPreview_Sidebar_Back("nav"))}this.Sidebar.addWidget("sitemap",new dmsDPPreview_Sidebar_Sitemap("nav"));if(a.show_comments){this.Sidebar.addWidget("comments",new dmsDPPreview_Sidebar_Comments("nav"))}this.Sidebar.render();this.Sidebar.setActiveTab();this.mCanvasEl.setStyle("left",this.mCanvasEl.getStyle("left").toIntZero()+this.Sidebar.mEl.getStyle("width").toIntZero());this.mCanvasResizeRef=function(b){this.canvasResize.delay(600,this,[b])}.bind(this);this.Sidebar.addEvent("toolbarShow",this.canvasResize.bind(this));this.Sidebar.addEvent("toolbarHide",this.canvasResize.bind(this));this.Menu=new dmsDPPreview_Menu(this.Sidebar.getWidget("sitemap").getToolbarEl(),this.mData.pages);this.Menu.load(this.mData.pages);if(a.show_comments){this.Comments=new DPPageComments(this.mData.comments,this.mData.id_page,this.mData.project_hash,this.Sidebar.getWidget("comments").getToolbarEl())}this.canvasResize()},canvasResize:function(b,c,g){var d=window.getWidth()-this.mCanvasEl.getStyle("left").toIntZero(),a=window.getHeight(),f=false;if(b&&c){d=window.getWidth()-this.Sidebar.mEl.getStyle("width").toIntZero();f=true;if("show"==c){d-=b.mToolbarWidth}if($defined(g)&&false==g.resize_workbench){f=false}}var e={width:d,height:a};var h={width:d,height:a-this.mCanvasEl.getElement("#canvas-wrapper").getStyle("top").toIntZero()};if(f){this.mCanvasEl.morph(e);this.mCanvasEl.getElement("#canvas-wrapper").morph(h)}else{this.mCanvasEl.setStyles(e);this.mCanvasEl.getElement("#canvas-wrapper").setStyles(h)}},isExport:function(){return this.mData.export_mode},isMenuEnabled:function(){return this.mData.menu_enabled},isCollaborationEnabled:function(){return this.mData.active_collaboration},prettyDate:function(c){var b=new Date((c||"").replace(/-/g,"/").replace(/[TZ]/g," ")),d=(((new Date()).getTime()-b.getTime())/1000),a=Math.floor(d/86400);if(isNaN(a)||a<0){return}return a==0&&(d<60&&"just now"||d<120&&"1 minute ago"||d<3600&&Math.floor(d/60)+" minutes ago"||d<7200&&"1 hour ago"||d<86400&&Math.floor(d/3600)+" hours ago")||a==1&&"Yesterday"||a<7&&a+" days ago"||Math.ceil(a/7)+" weeks ago"}});var dmsDPPreview_MainToolbar=new Class({Extends:DPMainToolbar,initialize:function(){this.mParentEl=document.getElement("#canvas");this.mItems=[]},addEl:function(a){this.mItems.push(a);this.render()},getEl:function(){return this.mEl}});